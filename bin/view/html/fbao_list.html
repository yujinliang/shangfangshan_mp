<html>
  <head>
    <meta charset="utf-8"
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <script type="text/javascript" src="../js/jquery-2.1.4.min.js"></script>
    <script type="text/javascript" src="../js/jquery.mobile-1.4.5.min.js"></script>
    <link rel="stylesheet" href="../js/jquery.mobile-1.4.5.min.css" type="text/css" />
    <style type="text/css">
        div[data-role=footer] {padding-left: 2%; padding-right: 2%;}
        #toorder {width: 89%;}
        div[data-role=fieldcontain] { padding: 0 10px; border-bottom-width: 0; margin-bottom: 5px;!important;}
        div[data-role=content] {border: 1px solid #EEE; padding: 0px 10px; margin: 10px 10px;border-radius: 8px;!important;}
        fieldset[data-role=controlgroup] {border: 1px solid #EEE;padding: 5px 5px;border-radius: 8px;!important;}
        #fbao_items {margin-bottom: 0px;border: 1px solid #EEE; border-radius: 8px;padding: 0px 8px;}
        #address_info {margin-top: 0px; margin-bottom: 10px; border: 1px solid #EEE; border-radius: 8px;}
    </style>
    <script type="text/javascript">
    
        $(document).ready(function () {
            $("#q7_jieyuan_fabao").attr("action", location.protocol + "//" + document.domain + "/do_forder")
        });
        /* for demo only */
        $(document).on("pagebeforecreate", "#fbao_list_page", function (e, ui) {
            //launch ajax for getting json data.
            $.getJSON("http://webapp.jinliangyu_weinxin_dev.tunnel.mobi" + "/getfbao_list?&count=20&page=1", function (data) {
                var items = ''
                $.each(data, function (i, item) { 
                    items += "<li>" + "<a href=fbao_detail.html?id=1001 data-ajax=false>" +item.name + i + "</a>" + "</li>"; 
                })
                $("#list").append(items).listview("refresh");
            });
        });
        var currentPageNumber = 1;
        /* load more fucntion */
        function addMore(page) {
            $.mobile.loading("show", {
                text: "Loading More...",
                textVisible: true,
                theme: "b"
            });
            setTimeout(function () {
                $.mobile.loading("hide");
            }, 2000);
            //launch ajax for getting json data.
            $.getJSON("http://webapp.jinliangyu_weinxin_dev.tunnel.mobi" + "/getfbao_list?count=20&page=" + (currentPageNumber + 1), function (data) {
                var items = ''
                $.each(data, function (i, item) {
                    
                    items += "<li>" + "<a href=fbao_detail.html?id=1001 data-ajax=false>" + item.name + i + i + "</a>" + "</li>";
                    
                })
                $("#list", page).append(items).listview("refresh");
                $.mobile.loading("hide");
                currentPageNumber += 1;
            });
        }

        /* scroll event */
        $(document).on("scrollstop", function (e) {
            var activePage = $.mobile.pageContainer.pagecontainer("getActivePage"),
            screenHeight = $.mobile.getScreenHeight(),
            contentHeight = $(".ui-content", activePage).outerHeight(),
            header = $(".ui-header", activePage).outerHeight() - 1,
            scrolled = $(window).scrollTop(),
            footer = $(".ui-footer", activePage).outerHeight() - 1,
            scrollEnd = contentHeight - screenHeight + header + footer;
            if (activePage[0].id == "fbao_list_page" && scrolled >= scrollEnd) {
                console.log("adding..." + activePage);
                addMore(activePage);
            }
        });
    </script>
    <title>法宝列表</title>
  </head>
  <body>
    <div data-role="page" id="fbao_list_page">
        <div data-role="content" class="ui-content">
            <ul data-role="listview" id="list" data-inset="true"></ul>
        </div>
        <div data-id="toorder_footer" data-role="footer" data-position="fixed" data-tap-toggle="false">
                <a id="toorder" data-role="button" data-theme="b" href="#fbao_do_order_page">去下单</a>
        </div>
    </div>
    
    <div id="fbao_do_order_page" data-role="dialog">
            <div data-role="header">
                <h1>法宝结缘单</h1>
            </div>
            <div data-role="content">
                <h4>法宝列表:</h4>
                <div id="fbao_items" >
                    <ul data-role="listview" data-inset=true>
                        <li>安士全书 [1] 本</li>
                        <li>念佛成佛 [1] 本</li>
                        <li>因果故事 [1] 本</li>
                    </ul>
                </div>
                <h4>快递信息:</h4>
                <div id="address_info">
                 
                    <form id="q7_jieyuan_fabao" action="#" method="post">
                        <div data-role="fieldcontain">
                            <label for="name">姓名:</label>
                            <input type="text" id="name" name ="name" data-clear-btn="true" data-mini="true"/>
                        </div>
                        <div data-role="fieldcontain">
                            <label for="phone_number">手机号:</label>
                            <input type="tel" id="phone_number" name="phone_number" data-clear-btn="true" data-mini="true"/>
                        </div>
                        <div data-role="fieldcontain">
                            <label for="postcode">邮编:</label>
                            <input type="text" id="postcode" name="postcode" data-clear-btn="true" data-mini="true"/>
                        </div>
                        <div data-role="fieldcontain">
                            <label for="address">邮寄地址:</label>
                            <input type="text" id="address" name="address" data-clear-btn="true" data-mini="true"/>
                        </div>
                        <input type="hidden" id="fbao_ids" name="fbao_ids" value="1001@1_1004@1"/>
                        <div data-role="fieldcontain">
                            <input type="submit" value="提交"/>
                            <a href="#" data-role="button" data-rel="back">关闭</a>
                        </div>
                </form>
                </div>
            </div>
    </div>
</body>
</html>